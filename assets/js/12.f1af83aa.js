(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{366:function(t,a,s){"use strict";s.r(a);var e=s(7),r=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("渲染数学公式，大致两个要点，渲染和排版。")]),t._v(" "),a("h2",{attrs:{id:"排版"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#排版"}},[t._v("#")]),t._v(" 排版")]),t._v(" "),a("p",[t._v("目前大部分的排版方式都是基于TEX或者Latex（基于TEX）。之所以使用Latex，是因为它完全使用文本描述排版，对于复杂的数学公式、表格、化学分子式等完全不在话下，甚至可以排五线谱、棋谱、电路图等。")]),t._v(" "),a("p",[t._v("而数学公式只是Latex的一个子集。")]),t._v(" "),a("h2",{attrs:{id:"渲染"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#渲染"}},[t._v("#")]),t._v(" 渲染")]),t._v(" "),a("p",[t._v("从数学公式到眼睛所看到的界面，这一过程，最重要的就是GUI渲染。像word、WPS等Native应用，是用系统提供的API，直接将公式输出到屏幕。而非Native应用，是用宿主提供的能力，将公式翻译成宿主可识别语言，从而将公式输出到屏幕。第三种则是将公式转换成已存在的图形规范，诸如PNG，SVG等格式，从而将公式输出到屏幕。")]),t._v(" "),a("p",[t._v("第二种和第三种在某种程度上是统一的。本文只讲述第二、三种。")]),t._v(" "),a("h2",{attrs:{id:"html"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#html"}},[t._v("#")]),t._v(" HTML")]),t._v(" "),a("p",[t._v("HTML作为标记语言，其宿主是浏览器。把公式翻译成HTML语言，由浏览器负责渲染到屏幕。")]),t._v(" "),a("h3",{attrs:{id:"技术实现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#技术实现"}},[t._v("#")]),t._v(" 技术实现")]),t._v(" "),a("h4",{attrs:{id:"katex"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#katex"}},[t._v("#")]),t._v(" Katex")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://katex.org/docs/api.html",title:"Katex",target:"_blank",rel:"noopener noreferrer"}},[t._v("Katex"),a("OutboundLink")],1),t._v(" 可以将latex公式语法转换成html，其格式、字体比较优美，转换速度快。\n用法：")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" html "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" katex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("renderToString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"c = \\\\pm\\\\sqrt{a^2 + b^2}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("throwOnError")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// '<span class=\"katex\">...</span>'")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("h4",{attrs:{id:"mathjax"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mathjax"}},[t._v("#")]),t._v(" MathJax")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://docs.mathjax.org/en/latest/basic/mathjax.html",title:"MathJax",target:"_blank",rel:"noopener noreferrer"}},[t._v("MathJax"),a("OutboundLink")],1),t._v(" 是一个开源的 JavaScript 显示引擎，适用于 LaTeX、MathML 和 AsciiMath 表示法，适用于所有现代浏览器。\n配置：")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MathJax "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("loader")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("load")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"input/tex"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"output/chtml"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("h4",{attrs:{id:"mathml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mathml"}},[t._v("#")]),t._v(" MathML")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/MathML",title:"MathML",target:"_blank",rel:"noopener noreferrer"}},[t._v("MathML"),a("OutboundLink")],1),t._v(" 是一个用于描述数学公式、符号的一种 XML (en-US) 标记语言，浏览器可以直接识别并渲染。但是这一特性并未在所有的浏览器中得到支持，仅仅firfox和safari支持，chrome的任何版本都不支持MathML。")]),t._v(" "),a("p",[t._v("直接编写MathML是相当困难的，通常我们会选择其他方式转换。")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/fred-wang/TeXZilla",title:"TeXZilla",target:"_blank",rel:"noopener noreferrer"}},[t._v("TeXZilla"),a("OutboundLink")],1),t._v("： 基于 Javascript 的 LaTeX to MathML 转换器。")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://dlmf.nist.gov/LaTeXML/",title:"LaTeXML",target:"_blank",rel:"noopener noreferrer"}},[t._v("LaTeXML"),a("OutboundLink")],1),t._v("：将 LaTeX 文档转换为 HTML+MathML 网页")]),t._v(" "),a("p",[t._v("MathJax 可以将输出格式设置为MathML。\nKatex 可以将输出格式设置为MathML。\n"),a("br")]),t._v(" "),a("blockquote",[a("p",[t._v("在渲染html公式时，框架一般提供了对应的css包，只有引入了这些包，你才能正常显示公式。")])]),t._v(" "),a("h2",{attrs:{id:"图片"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#图片"}},[t._v("#")]),t._v(" 图片")]),t._v(" "),a("p",[t._v("可以将数学公式转换为图片，即可在任何设备上展示。具有优秀的跨平台特性，但是和文字的排版相对困难。")]),t._v(" "),a("h3",{attrs:{id:"mathjax-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mathjax-2"}},[t._v("#")]),t._v(" MathJax")]),t._v(" "),a("p",[t._v("MathJax 可以将公式转换为SVG格式的图片。")]),t._v(" "),a("h3",{attrs:{id:"后端服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#后端服务"}},[t._v("#")]),t._v(" 后端服务")]),t._v(" "),a("p",[t._v("可以使用一些特殊的后端服务解析latex公式，生成预览图片。")]),t._v(" "),a("ol",[a("li",[a("a",{attrs:{href:"https://www.codecogs.com/",title:"codecogs",target:"_blank",rel:"noopener noreferrer"}},[t._v("codecogs"),a("OutboundLink")],1),t._v("是一个latex公式渲染服务，它根据get请求返回一个svg图片。")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/opencollab/jlatexmath",title:"jlatexmath",target:"_blank",rel:"noopener noreferrer"}},[t._v("jlatexmath"),a("OutboundLink")],1),t._v("：java版latex公式渲染服务\n使用例子：")])]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TeXFormula")]),t._v(" formula "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TeXFormula")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("latex"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TeXIcon")]),t._v(" icon "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" formula"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createTeXIcon")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TeXConstants")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("STYLE_DISPLAY")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BufferedImage")]),t._v(" image "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BufferedImage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("icon"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getIconWidth")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" icon"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getIconHeight")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BufferedImage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TYPE_BYTE_GRAY")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v("这里就不一一列举了，你甚至可以使用latex包，自己搭建一套服务。\n在web端使用时，只需要在img标签的src上附加上带有公式文本的get请求链接，即可显示公式。")]),t._v(" "),a("h2",{attrs:{id:"canvas"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#canvas"}},[t._v("#")]),t._v(" Canvas")]),t._v(" "),a("p",[t._v("我不认为用web canvas 渲染公式是一个好的方式，包括腾讯文档都没使用（尽管主体功能是用canvas实现的），但还是需要介绍一下这种方式。")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/CurriculumAssociates/canvas-latex",title:"canvas-latex",target:"_blank",rel:"noopener noreferrer"}},[t._v("canvas-latex"),a("OutboundLink")],1),t._v(" 可以将latex公式转换到canvas画布上。")]),t._v(" "),a("p",[t._v("当然，html和图片也是可以被渲染到canvas画布上，但是我认为这让排版变得极其困难。")]),t._v(" "),a("h2",{attrs:{id:"键入-公式编辑器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#键入-公式编辑器"}},[t._v("#")]),t._v(" 键入（公式编辑器）")]),t._v(" "),a("p",[t._v("能直接编写latex语法的人很少，为了方便使用，我们需要一个可以可视化输入的编辑器。")]),t._v(" "),a("p",[t._v("想想一下用户的使用过程，我们就可以知道，公式编辑器必然包含了公式的渲染，或采用图片，或采用html。")]),t._v(" "),a("ol",[a("li",[a("p",[a("a",{attrs:{href:"http://www.jmeditor.com/jme/intr.html",title:"JMEditor",target:"_blank",rel:"noopener noreferrer"}},[t._v("JMEditor"),a("OutboundLink")],1),t._v(" 是基于CKEditor、jQuery、MathQuill等组件开发的，轻量级、开放源代码、所见即所得、无任何插件的在线公式编辑器。")])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://github.com/fex-team/kityformula-editor",title:"kityformula-editor",target:"_blank",rel:"noopener noreferrer"}},[t._v("kityformula-editor"),a("OutboundLink")],1),t._v(" 是基于 SVG 的公式编辑器，百度前端富应用小组开发。")])])]),t._v(" "),a("p",[t._v("公式编辑器大多是一个弹出框，最后输出公式。所以这些编辑器可以被集成到各个富文本编辑器中去，只需要你理解对应富文本编辑器的插件机制即可。像kityformula-editor，就可以被集成到富文本"),a("a",{attrs:{href:"http://tinymce.ax-z.cn/general/basic-setup.php",title:"tinyMCE",target:"_blank",rel:"noopener noreferrer"}},[t._v("tinyMCE"),a("OutboundLink")],1),t._v("中。")]),t._v(" "),a("h2",{attrs:{id:"富文本编辑器中的公式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#富文本编辑器中的公式"}},[t._v("#")]),t._v(" 富文本编辑器中的公式")]),t._v(" "),a("p",[t._v("单独使用公式编辑器的场景比较少，大部分我们还是将它集成到富文本编辑器中。当我们存储富文本时，会存储其html文本。公式或存储成html、或图片。当我们在富文本编辑器中编辑的时候，如果公式被存储成图片，光标系统可很好的左右移动；但是如果被存储为html，没有经过精心设计的光标系统，会出先左右移动出现不可预料的情况。")]),t._v(" "),a("p",[t._v("tinyMCE是将公式显示成图；腾讯文档存储成了html，但是其光标系统经过精心设计，可以左右移动，跨过公式。")]),t._v(" "),a("p",[t._v("我曾经尝试过将kityformula-editor集成到wangEditor中，并输出html公式。光标在公式的html中迷失方向，无法跳出。如果你不在乎这个缺陷，也可以使用html公式。")])])}),[],!1,null,null,null);a.default=r.exports}}]);