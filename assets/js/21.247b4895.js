(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{376:function(s,a,e){"use strict";e.r(a);var n=e(7),t=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"签名方案简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#签名方案简介"}},[s._v("#")]),s._v(" 签名方案简介")]),s._v(" "),a("ol",[a("li",[s._v("v1方案：基于 JAR 签名")]),s._v(" "),a("li",[s._v("v2方案：APK 签名方案 v2 是在 Android 7.0 (Nougat) 中引入的。为了使 APK 可在 Android 6.0 (Marshmallow) 及更低版本的设备上安装，应先使用 JAR 签名功能对 APK 进行签名，然后再使用 v2 方案对其进行签名。")])]),s._v(" "),a("p",[s._v("一般apk都会进行v1和v2签名，v1签名是为了兼容低版本的系统，v2签名是为了提高安全性。React Native打的包也是如此。")]),s._v(" "),a("h3",{attrs:{id:"检查签名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#检查签名"}},[s._v("#")]),s._v(" 检查签名")]),s._v(" "),a("blockquote",[a("p",[s._v("使用"),a("code",[s._v("apksigner")]),s._v("工具检查签名信息,"),a("code",[s._v("apksigner")]),s._v("工具在"),a("code",[s._v("Android SDK")]),s._v("的"),a("code",[s._v("build-tools")]),s._v("目录下，如"),a("code",[s._v("/Users/xxx/Library/Android/sdk/build-tools/34.0.0/apksigner")]),s._v("，可以将其添加到环境变量中，方便使用。")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看签名信息")]),s._v("\napksigner verify "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-verbose")]),s._v(" -print-certs  my_application.apk\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("输出如下：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("Verifies\nVerified using v1 scheme "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("JAR signing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nVerified using v2 scheme "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("APK Signature Scheme v2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nVerified using v3 scheme "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("APK Signature Scheme v3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\nVerified using v3.1 scheme "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("APK Signature Scheme v3.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\nVerified using v4 scheme "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("APK Signature Scheme v4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\nVerified "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" SourceStamp: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\nNumber of signers: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("这是React Native 包的签名信息，可以看到v1和v2签名都是true，说明这个包是经过v1和v2签名的。")]),s._v(" "),a("h3",{attrs:{id:"签名配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#签名配置"}},[s._v("#")]),s._v(" 签名配置")]),s._v(" "),a("p",[s._v("可在"),a("code",[s._v("android/app/build.gradle")]),s._v("中配置签名信息，如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("android {\n    ...\n    signingConfigs {\n        release {\n            storeFile file('release.keystore')\n            storePassword 'keystore密码'\n            keyAlias 'key别名'\n            keyPassword 'key密码'\n            v1SigningEnabled true\n            v2SigningEnabled true\n            v3SigningEnabled true\n        }\n    }\n    buildTypes {\n        release {\n            signingConfig signingConfigs.release\n            ...\n        }\n    }\n    ...\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h3",{attrs:{id:"主动签名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主动签名"}},[s._v("#")]),s._v(" 主动签名")]),s._v(" "),a("p",[s._v("有时我们会对已经签名的包进行变更，例如添加或者删除文件，一旦对文件进行变更，签名就会失效。因为签名正是记录文件摘要的，此时需要再次签名。可以使用"),a("code",[s._v("apksigner")]),s._v("工具进行主动签名，如下：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 签名")]),s._v("\napksigner sign "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--ks")]),s._v(" ./android/app/my-release-key.keystore --v1-signing-enabled "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" --v2-signing-enabled "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" --v3-signing-enabled "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("  --v4-signing-enabled "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--out")]),s._v(" my_application_signed.apk my_application.apk\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("这会提示你输入keystore密码、key密码，输入后即可完成签名。也可在指令中添加"),a("code",[s._v("--ks-pass pass:keystore密码")]),s._v("和"),a("code",[s._v("--key-pass pass:key密码")]),s._v("，这样就不需要手动输入密码了。")]),s._v(" "),a("p",[s._v("对apk包进行文件处理可以使用"),a("code",[s._v("aapt")]),s._v("工具，如：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看apk包中的文件")]),s._v("\naapt dump badging my_application.apk\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("也可向apk中添加文件，如：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 向apk中添加文件")]),s._v("\naapt "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" my_application.apk assets/xxx.png\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("blockquote",[a("p",[s._v("向apk中添加文件时，如果想在指定目录中增加文件，你需要在本地目录中创建相应的目录结构，然后将文件放入其中，再使用"),a("code",[s._v("aapt add")]),s._v("命令添加文件。")])])])}),[],!1,null,null,null);a.default=t.exports}}]);